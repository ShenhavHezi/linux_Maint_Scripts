# linux-maint — Follow-up (Professional Roadmap)

This roadmap prioritizes improvements that make **linux-maint** safer to run in production,
more reliable for on-call usage, and easier to maintain long-term.

Guiding principles:
- Preserve the **summary contract** (monitor line protocol) as the stable automation interface.
- Prefer changes that reduce operational surprises: deterministic output, deterministic exit codes.
- Security defaults must be safe for fleet/SSH operation.

---

## P0 — Production safety & correctness (highest priority)

### 1) Formalize exit codes + severity semantics

NOTE: The wrapper already documents and uses exit codes 0/1/2/3; the remaining work is to ensure **every monitor** follows it consistently and tests enforce it.
- Define a stable policy and enforce it across wrapper + monitors:
  - `OK=0`, `WARN=1`, `CRIT=2`, `UNKNOWN=3`
- Ensure **every monitor** uses these exit codes.
- Ensure the wrapper’s `overall` maps to the same policy.

### 2) Contract enforcement: every monitor emits a summary line
- Keep the wrapper hardening that emits `reason=no_summary_emitted`.
- Add a test that fails if any monitor can exit non-zero without a `monitor=` summary line.
- Make `docs/reference.md` explicitly state this as a contract requirement.

### 3) Security hardening for fleet/SSH mode
- Ensure non-interactive and safe SSH defaults:
  - `BatchMode=yes`, `ConnectTimeout`, `ServerAliveInterval/CountMax`
  - avoid agent forwarding by default
- Guard against command injection:
  - never eval untrusted config content
  - carefully quote hostnames, paths, ssh options
- Keep and document `linux-maint run --dry-run` for auditing target hosts; add tests to ensure it never executes remote commands.

### 4) Tests that match real operator behavior
Add CI tests covering:
- `linux-maint status`:
  - non-root installed mode => single error + hint (no loops/spam)
  - root installed mode => compact totals + minimal severity-sorted problems
  - `--verbose` prints raw summary lines
  - `--problems N` capped at 100
- Wrapper smoke test:
  - local-only run creates artifacts (`latest` symlinks, `last_status_full`, summary log/json)
  - summary lines match the contract

---

## P1 — Operability (make it great for admins/on-call)

### 5) Status UX improvements
- Add `linux-maint status --quiet`:
  - print only: overall + totals + problems (no paths/build info)
- Add `linux-maint status --json`:
  - machine output combining `last_status_full` + summary json/log
  - enables easy integration with external tooling
- Add optional `--since <duration>` filtering for problems (requires timestamps in summary lines or derive from artifacts).

### 6) Notification/alerting improvements
- Email/webhook messages should use the same compact problem summary as `status`.
- Add “only on change” support (already mentioned) and ensure it’s tested.
- Add a simple template mechanism so operators can customize subject/body.

### 7) Log rotation + retention policy
- Ensure `/var/log/health` artifacts are rotated and old logs cleaned.
- Provide a documented retention strategy (days/size) and safe defaults.

---

## P2 — Packaging, deployment, and compatibility (partially exists)

### 8) First-class packaging
- Provide packaging that is easy to consume. Current repo already includes **RPM packaging** under `packaging/rpm/` and a tarball builder; next step is to harden and document the release workflow.
- Package should install:
  - `/usr/local/bin/linux-maint`
  - wrapper and libexec helpers
  - systemd unit/timer (optional but recommended)
  - default config templates under `/usr/local/share/...`

### 9) Systemd service/timer robustness
- Confirm unit behavior:
  - locked down permissions
  - no environment surprises
  - clear journald output
- Provide commands/docs:
  - enable/disable timer
  - run once
  - view last run

### 10) Platform coverage
- Clearly document supported distros and minimum required tools.
- Add detection and graceful degradation for missing commands (prefer `SKIP` or `UNKNOWN reason=missing_dependency`).

---

## P3 — Monitor quality & consistency

### 11) Standardize `reason=` tokens and fields
- For every non-OK summary line, require `reason=<token>`.
- Maintain `docs/REASONS.md` as a controlled vocabulary.
- Add a lint/test that checks:
  - status != OK => reason exists (with explicit exceptions documented)

### 12) Performance & timeouts
- Review monitors for worst-case runtime.
- Ensure wrapper-level timeout is sufficient and per-monitor overrides are possible.
- Consider limited parallelism where safe (especially remote host checks), with caps.

### 13) Reduce noise, increase signal
- Prefer one summary line per monitor per host (or clearly defined multi-line rules).
- Avoid emitting large raw data in summary lines; put details in full logs.

---

## P4 — Developer experience & governance

### 14) “Make it easy to contribute”
- Add `make lint`, `make test`, `make install`.
- Add a CONTRIBUTING guide:
  - monitor contract
  - how to add a monitor
  - how to run tests locally

### 15) CI enforcement for meta docs
- Enforce that `summarize.txt` and `ToDoList.txt` stay current:
  - GitHub Action that fails if significant code changes happen without updating these files
  - optional local `pre-push` hook for convenience

### 16) Release process
- Versioning policy (SemVer-ish) and changelog.
- Tag releases and attach packaged artifacts.
